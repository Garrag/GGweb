var Data=function(){function t(){}var e=(__define,t);return p=e.prototype,t.getStageHeight=function(){return egret.MainContext.instance.stage.stageHeight},t.getStageWidth=function(){return egret.MainContext.instance.stage.stageWidth},t.getRectWidth=function(){return t.getStageWidth()/4},t.getTotalRows=function(){return Math.ceil(t.getStageHeight()/t.getRectWidth())+1},t.EVENT_GAMEOVER="gameover",t.EVENT_CLICKRIGHT="clickright",t.EVENT_STARTGAME="startgame",t.SCORE=0,t}();egret.registerClass(Data,"Data");var Game=function(){function t(t){this._root=t,this.createContainer(),this.startGame()}var e=(__define,t);return p=e.prototype,p.createContainer=function(){this._rows=Data.getTotalRows(),this._rectRoot=new egret.Sprite,this._root.addChild(this._rectRoot),this._groups=[],console.log("totalRows "+this._rows);for(var t,e=0;e<this._rows;e++)t=new GroupRect,this._rectRoot.addChild(t),console.log("add group "+e),this._groups.push(t),t.addEventListener(Data.EVENT_CLICKRIGHT,this.movenext,this),t.addEventListener(Data.EVENT_GAMEOVER,this.gameover,this),t.layout(e);this._rectRoot.y=Data.getStageHeight()-this._rectRoot.height},p.movenext=function(){Data.SCORE++;for(var t=0;t<this._rows;t++)this._groups[t].move()},p.gameover=function(){console.log("gameover"),this.timerPanel.stop(),this.timerPanel.removeSelf(),this.gameoverPanel||(this.gameoverPanel=new GameOverPanel,this.gameoverPanel.addEventListener(Data.EVENT_STARTGAME,this.restartGame,this)),this._root.addChild(this.gameoverPanel)},p.initGame=function(){Data.SCORE=0;for(var t=0;t<Data.getTotalRows();t++)this._groups[t].init(),this._groups[t].createBlackRect()},p.restartGame=function(){this.gameoverPanel&&this.gameoverPanel.removeSelf(),this.initGame(),this.startGame()},p.startGame=function(){this.timerPanel||(this.timerPanel=new TimerPanel,this.timerPanel.addEventListener(Data.EVENT_GAMEOVER,this.gameover,this)),this._root.addChild(this.timerPanel),this.timerPanel.start(),console.log("start game")},p.stopGame=function(){this.timerPanel.stop()},t}();egret.registerClass(Game,"Game");var GameOverPanel=function(t){function e(){t.call(this),this.draw(),this.addEventListener(egret.Event.ADDED_TO_STAGE,this.showText,this)}__extends(e,t);var i=(__define,e);return p=i.prototype,p.draw=function(){this.width=Data.getStageWidth(),this.height=Data.getStageHeight(),this.graphics.beginFill(1118481,.5),this.graphics.drawRect(0,0,Data.getStageWidth(),Data.getStageHeight()),this.graphics.endFill(),this.txt=new egret.TextField,this.addChild(this.txt),this.txt.width=Data.getStageWidth(),this.txt.textColor=16711680,this.txt.textAlign=egret.HorizontalAlign.CENTER,this.txt.y=100;var t=new egret.Sprite;this.addChild(t),t.graphics.beginFill(16776960),t.graphics.drawRect(0,0,200,100),t.graphics.endFill(),t.x=Data.getStageWidth()/2-100,t.y=Data.getStageHeight()/2-50,t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.start,this)},p.start=function(){this.dispatchEventWith(Data.EVENT_STARTGAME)},p.showText=function(){this.txt.text="YOUR SCORES: "+Data.SCORE},p.removeSelf=function(){this.parent&&this.parent.removeChild(this)},e}(egret.Sprite);egret.registerClass(GameOverPanel,"GameOverPanel");var GroupRect=function(t){function e(){t.call(this),this._currentRow=0,this.createRects(),this.createBlackRect(),this.layout(0)}__extends(e,t);var i=(__define,e);return p=i.prototype,p.createRects=function(){this._rects=[];for(var t,e=0;4>e;e++)t=new Rect,this.addChild(t),this._rects.push(t),t.x=Data.getRectWidth()*e,t.addEventListener(Data.EVENT_CLICKRIGHT,this.clickRight,this),t.addEventListener(Data.EVENT_GAMEOVER,this.gameover,this)},p.createBlackRect=function(){this.init();var t=Math.floor(4*Math.random());this._rects[t].type=RectType.CLICKABLE},p.layout=function(t){this._currentRow=t,this.y=Data.getRectWidth()*this._currentRow},p.clickRight=function(t){this.dispatchEventWith(Data.EVENT_CLICKRIGHT)},p.gameover=function(){this.dispatchEventWith(Data.EVENT_GAMEOVER)},p.move=function(){this._currentRow++,this._currentRow==Data.getTotalRows()&&(this._currentRow=0,this.createBlackRect()),this.layout(this._currentRow)},p.init=function(){for(var t=0;4>t;t++)this._rects[t].init(),console.log("GroupRect init "+this._rects[t].hasClicked)},e}(egret.Sprite);egret.registerClass(GroupRect,"GroupRect");var LoadingUI=function(t){function e(){t.call(this),this.createView()}__extends(e,t);var i=(__define,e);return p=i.prototype,p.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},p.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);egret.registerClass(LoadingUI,"LoadingUI");var Main=function(t){function e(){t.call(this);new Game(this)}__extends(e,t);var i=(__define,e);return p=i.prototype,e}(egret.DisplayObjectContainer);egret.registerClass(Main,"Main");var Rect=function(t){function e(){t.call(this),this._type=RectType.NONClICKABLE,this._colors=[0,16777215,16711680,255],this._currentColor=1,this.hasClicked=!1,this.draw(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRectClick,this)}__extends(e,t);var i=__define,r=e;return p=r.prototype,p.draw=function(){this.width=Data.getRectWidth(),this.height=Data.getRectWidth(),this.graphics.beginFill(this._colors[this._currentColor]),this.graphics.lineStyle(2,0),this.graphics.drawRect(0,0,Data.getRectWidth(),Data.getRectWidth()),this.graphics.endFill()},i(p,"type",function(){return this._type},function(t){this._type=t,t==RectType.CLICKABLE?this._currentColor=0:this._currentColor=1,this.draw()}),p.init=function(){this.hasClicked=!1,this.type=RectType.NONClICKABLE,console.log("hasClicked change to "+!1)},p.onRectClick=function(){console.log("onRectClick hasClicked "+this.hasClicked),this.hasClicked||(this.hasClicked=!0,this._type==RectType.CLICKABLE?(this._currentColor=3,this.dispatchEventWith(Data.EVENT_CLICKRIGHT)):(this._currentColor=2,this.dispatchEventWith(Data.EVENT_GAMEOVER)),this.draw(),console.log("hasClicked change to "+!0))},e}(egret.Sprite);egret.registerClass(Rect,"Rect");var RectType=function(){function t(){}var e=(__define,t);return p=e.prototype,t.NONClICKABLE="nonclickable",t.CLICKABLE="clickable",t}();egret.registerClass(RectType,"RectType");var TimerPanel=function(t){function e(){t.call(this),this.remindSeconds=e.TOTALSECONDS,this.draw(),this.createTimer()}__extends(e,t);var i=(__define,e);return p=i.prototype,p.draw=function(){this.y=Data.getStageHeight()/2,this.txt=new egret.TextField,this.addChild(this.txt),this.txt.width=Data.getStageWidth(),this.txt.textAlign=egret.HorizontalAlign.CENTER,this.txt.textColor=16711680},p.createTimer=function(){this.timer=new egret.Timer(1e3,e.TOTALSECONDS),this.timer.addEventListener(egret.TimerEvent.TIMER,this.onTimer,this),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.onTimerComplete,this)},p.onTimer=function(){this.remindSeconds--,console.log("remindSeconds "+this.remindSeconds),this.txt.text=this.remindSeconds+" seconds"},p.onTimerComplete=function(){this.dispatchEventWith(Data.EVENT_GAMEOVER)},p.start=function(){this.remindSeconds=e.TOTALSECONDS,this.timer.reset(),this.timer.start(),console.log("timer start")},p.stop=function(){this.timer.stop()},p.removeSelf=function(){this.parent&&this.parent.removeChild(this)},e.TOTALSECONDS=20,e}(egret.Sprite);egret.registerClass(TimerPanel,"TimerPanel");